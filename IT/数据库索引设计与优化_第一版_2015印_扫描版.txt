封面                                                                            1
目录                                                                            16
第1章 概述                                                                      25
	关于SQL 性能的另一本书                                                          25
	不合适的索引                                                                    27
	误区和误解                                                                      28
	误区1：索引层级不要超过5 层                                                     29
	误区2：单表的索引数不要超过6 个                                                 30
	误区3：不应该索引不稳定的列                                                     30
	示例                                                                            31
	磁盘驱动器使用率                                                                31
	系统化的索引设计                                                                32
第２章 表和索引结构                                                             34
	介绍                                                                            34
	索引页和表页                                                                    35
	索引行                                                                          35
	索引结构                                                                        36
	表行                                                                            36
	缓冲池和磁盘I/O                                                                 36
	从DBMS 缓冲池进行的读取                                                         37
	从磁盘驱动器进行的随机I/O                                                       37
	从磁盘服务器缓存进行的读取                                                      38
	从磁盘驱动器进行的顺序读取                                                      39
	辅助式随机读                                                                    39
	辅助式顺序读                                                                    42
	同步I/O 和异步I/O                                                               42
	硬件特性                                                                        43
	DBMS 特性                                                                       44
	页                                                                              44
	表聚簇                                                                          45
	索引行                                                                          45
	表行                                                                            46
	索引组织表                                                                      46
	页邻接                                                                          47
	B树索引的替代品                                                                 48
	聚簇的许多含义                                                                  49
第3章 SQL处理过程                                                               51
	简介                                                                            51
	谓词                                                                            51
	评注                                                                            52
	优化器及访问路径                                                                52
	索引片及匹配列                                                                  53
	索引过滤及过滤列                                                                53
	访问路径术语                                                                    55
	监控优化器                                                                      56
	帮助优化器（统计信息）                                                          56
	帮助优化器（FETCH 调用的次数）                                                  56
	何时确定访问路径                                                                57
	过滤因子                                                                        58
	组合谓词的过滤因子                                                              59
	过滤因子对索引设计的影响                                                        61
	物化结果集                                                                      63
	游标回顾                                                                        63
	方式1：一次FETCH 调用物化一条记录                                               64
	方式2：提前物化                                                                 65
	数据库设计人员必须牢记                                                          65
	练习                                                                            65
第4章 为SELETE语句创建理想的索引                                                67
	简介                                                                            67
	磁盘及CPU 时间的基础假设                                                        68
	不合适的索引                                                                    68
	三星索引——查询语句的理想索引                                                  69
	星级是如何给定的                                                                70
	范围谓词和三星索引                                                              72
	为查询语句设计最佳索引的算法                                                    73
	候选A                                                                           74
	候选B                                                                           74
	现今排序速度很快——为什么我们还需要候选B                                       75
	需要为所有查询语句都设计理想索引吗                                              76
	完全多余的索引                                                                  76
	近乎多余的索引                                                                  77
	可能多余的索引                                                                  77
	新增一个索引的代价                                                              78
	响应时间                                                                        78
	磁盘负载                                                                        79
	磁盘空间                                                                        80
	一些建议                                                                        81
	练习                                                                            82
第5章 前瞻性的索引设计                                                          83
	发现不合适的索引                                                                83
	基本问题法（BQ）                                                                83
	注意                                                                            84
	快速上限估算法（QUBE）                                                          85
	服务时间                                                                        86
	排队时间                                                                        86
	基本概念：访问                                                                  87
	计算访问次数                                                                    89
	FETCH 处理                                                                      90
	主要访问路径的QUBE 示例                                                         91
	使用满足需求的成本最低的索引还是所能达到的最优索引：示例1                       96
	该事务的基本问题                                                                97
	对该事务上限的快速估算                                                          97
	使用满足需求的成本最低的索引还是所能达到的最优索引                              98
	该事务的最佳索引                                                                99
	半宽索引（最大化索引过滤）                                                      99
	宽索引（只需访问索引）                                                          100
	使用满足需求的成本最低的索引还是所能达到的最优索引：示例2                       101
	范围事务的BQ 及QUBE                                                             102
	该事务的最佳索引                                                                103
	半宽索引（最大化索引过滤）                                                      104
	宽索引（只需访问索引）                                                          105
	何时使用QUBE                                                                    106
第6章 影响索引设计过程的因素                                                    107
	I/O 时间估算的验证                                                              107
	多个窄索引片                                                                    108
	简单就是美（和安全）                                                            110
	困难谓词                                                                        111
	LIKE谓词                                                                        111
	OR操作符和布尔谓词                                                              112
	IN谓词                                                                          113
	过滤因子隐患                                                                    114
	过滤因子隐患的例子                                                              116
	最佳索引                                                                        119
	半宽索引（最大化索引过滤）                                                      120
	宽索引（只需访问索引）                                                          121
	总结                                                                            121
	练习                                                                            123
第7章 被动式索引设计                                                            124
	简介                                                                            124
	EXPLAIN 描述了所选择的访问路径                                                  125
	全表扫描或全索引扫描                                                            125
	对结果集排序                                                                    125
	成本估算                                                                        126
	数据库管理系统特定的EXPLAIN 选项及限制                                          126
	监视揭示现实                                                                    127
	性能监视器的演进                                                                128
	LRT级别的异常监视                                                               130
	程序粒度的均值是不够的                                                          130
	异常报告举例：每个尖刺一行                                                      130
	问题制造者和受害者                                                              132
	有优化空间的问题制造者和无优化空间的问题制造者                                  132
	有优化空间的问题制造者                                                          133
	调优的潜在空间                                                                  135
	无优化空间的问题制造者                                                          138
	受害者                                                                          139
	查找慢的SQL调用                                                                 141
	调用级别的异常监视                                                              142
	Oracle 举例                                                                     145
	SQL Server 举例                                                                 147
	结论                                                                            149
	数据库管理系统特定的监视问题                                                    150
	尖刺报告                                                                        151
	练习                                                                            151
第8章 为表连接设计索引                                                          153
	简介                                                                            153
	两个简单的表连接                                                                155
	例8.1：CUST 表作为外层表                                                        155
	例8.2：INVOICE 表作为外层表                                                     156
	表访问顺序对索引设计的影响                                                      157
	案例研究                                                                        157
	现有索引                                                                        160
	理想索引                                                                        166
	理想索引，每事务物化一屏结果集                                                  170
	理想索引，每事务物化一屏结果集且遇到FF 缺陷                                     173
	基本连接的问题（BJQ）                                                           175
	结论：嵌套循环连接                                                              177
	预测表的访问顺序                                                                177
	合并扫描连接和哈希连接                                                          179
	合并扫描连接                                                                    179
	例8.3：合并扫描连接                                                             179
	哈希连接                                                                        181
	程序C：由优化器选择MS/HJ（在现有索引条件下）                                    182
	理想索引                                                                        183
	嵌套循环连接 VS MS/HJ及理想索引                                                 185
	嵌套循环连接 VS MS/HJ                                                           185
	嵌套循环连接 VS 理想索引                                                        186
	连接两张以上的表                                                                187
	为什么连接的性能表现较差                                                        190
	模糊的索引设计                                                                  190
	优化器可能选择错误的表访问路径                                                  190
	乐观的表设计                                                                    190
	为子查询设计索引                                                                191
	为UNION 语句设计索引                                                            191
	对于表设计的思考                                                                191
	冗余数据                                                                        191
	无意识的表设计                                                                  195
	练习                                                                            197
第9章 星型连接                                                                  199
	介绍                                                                            199
	维度表的索引设计                                                                201
	表访问顺序的影响                                                                202
	事实表的索引                                                                    203
	汇总表                                                                          206
第10 章 多索引访问                                                              208
	简介                                                                            208
	索引与                                                                          208
	与查询表一同使用索引与                                                          210
	多索引访问和事实数据表                                                          211
	用位图索引进行多索引访问                                                        211
	索引或                                                                          212
	索引连接                                                                        213
	练习                                                                            214
第11章 索引和索引重组                                                           215
	B树索引的物理结构                                                               215
	DBMS 如何查找索引行                                                             216
	插入一行时会发生什么                                                            217
	叶子页的分裂严重吗                                                              218
	什么时候应该对索引进行重组                                                      220
	插入模式                                                                        220
	索引列的稳定性                                                                  229
	长索引行                                                                        231
	举例：对顺序敏感的批处理任务                                                    232
	表乱序（存在聚簇索引）                                                          235
	表乱序（没有以CNO开头的聚簇索引）                                               236
	存储在叶子页中的表行                                                            236
	SQL Server                                                                      236
	Oracle                                                                          237
	索引重组的代价                                                                  238
	分裂的监控                                                                      239
	总结                                                                            240
第12章 数据库管理系统相关的索引限制                                             243
	简介                                                                            243
	索引列的数量                                                                    243
	索引列的总长度                                                                  244
	变长列                                                                          244
	单表索引数量上限                                                                244
	索引大小上限                                                                    244
	索引锁定                                                                        245
	索引行压缩                                                                      245
	数据库管理系统索引创建举例                                                      246
第13章 数据库索引选项                                                           248
	简介                                                                            248
	索引行压缩                                                                      248
	索引键以外的其他索引列                                                          249
	唯一约束                                                                        251
	从不同的方向扫描数据库索引                                                      251
	索引键截断                                                                      252
	基于函数的索引                                                                  252
	索引跳跃式扫描                                                                  253
	块索引                                                                          254
	数据分区的二级索引                                                              254
	练习                                                                            255
第14章 优化器不是完美的                                                         256
	简介                                                                            256
	优化器并不总能看见最佳方案                                                      258
	匹配及过滤问题                                                                  258
	非BT谓词                                                                        258
	无法避免的排序                                                                  261
	不必要的表访问                                                                  262
	优化器的成本估算可能错得离谱                                                    263
	使用绑定变量的范围谓词                                                          263
	偏斜分布                                                                        265
	相关列                                                                          266
	部分索引键的警示故事                                                            267
	成本估算公式                                                                    270
	估算I/O时间                                                                     271
	估算CPU时间                                                                     272
	协助优化器处理估算相关的问题                                                    273
	优化器的问题是否会影响索引设计                                                  276
	练习                                                                            277
第15章 其他评估事项                                                             278
	QUBE 公式背后的假设条件                                                         278
	内存中的非叶子索引页                                                            279
	例子                                                                            279
	磁盘服务器读缓存的影响                                                          280
	缓冲子池                                                                        282
	长记录                                                                          283
	慢速顺序读                                                                      283
	实际的响应时间可能比QUBE 评估值短得多                                           283
	叶子页和表页缓存在缓冲池中                                                      284
	识别低成本的随机访问                                                            286
	辅助式随机读取                                                                  286
	辅助式顺序读                                                                    289
	评估CPU时间（CQUBE）                                                            289
	单次顺序访问的CPU时间                                                           289
	单次随机访问的CPU时间                                                           291
	单次FETCH 调用的CPU时间                                                         293
	每排序一行的平均CPU时间                                                         294
	CPU评估举例                                                                     294
	宽索引还是理想索引                                                              294
	嵌套循环（及反范式化）还是MS/HJ                                                 295
	合并扫描与哈希连接的比较                                                        298
	跳跃式顺序扫描                                                                  299
	CPU时间仍然不可忽视                                                             300
第16章 组织索引设计过程                                                         301
	简介                                                                            301
	计算机辅助式索引设计                                                            302
	设计出色索引的9个步骤                                                           304
参考文献                                                                        306
术语表                                                                          307
索引                                                                            315